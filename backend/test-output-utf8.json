
> backend@0.0.1 test
> jest src/users/users.service.spec.ts --json

{"numFailedTestSuites":1,"numFailedTests":4,"numPassedTestSuites":0,"numPassedTests":4,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":1,"numTotalTests":8,"openHandles":[],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1772046667645,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["UsersService"],"duration":10,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"UsersService should be defined","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1772046669098,"status":"passed","title":"should be defined"},{"ancestorTitles":["UsersService","uploadAvatar"],"duration":4,"failing":false,"failureDetails":[{}],"failureMessages":["TypeError: this.usersRepository.findOneBy is not a function\n    at UsersService.findOne (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\src\\users\\users.service.ts:40:37)\n    at UsersService.uploadAvatar (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\src\\users\\users.service.ts:26:40)\n    at Object.<anonymous> (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\src\\users\\users.service.spec.ts:65:28)"],"fullName":"UsersService uploadAvatar should upload file and update user avatar url","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"startAt":1772046669110,"status":"failed","title":"should upload file and update user avatar url"},{"ancestorTitles":["UsersService","uploadAvatar"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"UsersService uploadAvatar should throw error if upload fails","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1772046669120,"status":"passed","title":"should throw error if upload fails"},{"ancestorTitles":["UsersService","remove"],"duration":3,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"UsersService remove should delete a user for id != 1","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1772046669123,"status":"passed","title":"should delete a user for id != 1"},{"ancestorTitles":["UsersService","remove"],"duration":6,"failing":false,"failureDetails":[],"failureMessages":[],"fullName":"UsersService remove should block deleting the primary super admin account (id: 1)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"startAt":1772046669126,"status":"passed","title":"should block deleting the primary super admin account (id: 1)"},{"ancestorTitles":["UsersService","updatePassword"],"duration":11,"failing":false,"failureDetails":[{"matcherResult":{"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Utilisateur introuvable.\"\nReceived message:   \"this.usersRepository.findOneBy is not a function\"\n\n    \u001b[0m \u001b[90m 38 |\u001b[39m\n     \u001b[90m 39 |\u001b[39m     \u001b[36masync\u001b[39m findOne(id\u001b[33m:\u001b[39m number)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m         \u001b[36mreturn\u001b[39m \u001b[36mthis\u001b[39m\u001b[33m.\u001b[39musersRepository\u001b[33m.\u001b[39mfindOneBy({ id })\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 41 |\u001b[39m     }\n     \u001b[90m 42 |\u001b[39m\n     \u001b[90m 43 |\u001b[39m     \u001b[36masync\u001b[39m findByUsername(username\u001b[33m:\u001b[39m string)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\u001b[0m\n\n      at UsersService.findOne (src/users/users.service.ts:40:37)\n      at UsersService.updatePassword (src/users/users.service.ts:81:33)\n      at Object.<anonymous> (src/users/users.service.spec.ts:100:34)","pass":false},"message":"expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Utilisateur introuvable.\"\nReceived message:   \"this.usersRepository.findOneBy is not a function\"\n\n    \u001b[0m \u001b[90m 38 |\u001b[39m\n     \u001b[90m 39 |\u001b[39m     \u001b[36masync\u001b[39m findOne(id\u001b[33m:\u001b[39m number)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m         \u001b[36mreturn\u001b[39m \u001b[36mthis\u001b[39m\u001b[33m.\u001b[39musersRepository\u001b[33m.\u001b[39mfindOneBy({ id })\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 41 |\u001b[39m     }\n     \u001b[90m 42 |\u001b[39m\n     \u001b[90m 43 |\u001b[39m     \u001b[36masync\u001b[39m findByUsername(username\u001b[33m:\u001b[39m string)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\u001b[0m\n\n      at UsersService.findOne (src/users/users.service.ts:40:37)\n      at UsersService.updatePassword (src/users/users.service.ts:81:33)\n      at Object.<anonymous> (src/users/users.service.spec.ts:100:34)"}],"failureMessages":["Error: expect(received).rejects.toThrow(expected)\n\nExpected substring: \"Utilisateur introuvable.\"\nReceived message:   \"this.usersRepository.findOneBy is not a function\"\n\n    \u001b[0m \u001b[90m 38 |\u001b[39m\n     \u001b[90m 39 |\u001b[39m     \u001b[36masync\u001b[39m findOne(id\u001b[33m:\u001b[39m number)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m         \u001b[36mreturn\u001b[39m \u001b[36mthis\u001b[39m\u001b[33m.\u001b[39musersRepository\u001b[33m.\u001b[39mfindOneBy({ id })\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 41 |\u001b[39m     }\n     \u001b[90m 42 |\u001b[39m\n     \u001b[90m 43 |\u001b[39m     \u001b[36masync\u001b[39m findByUsername(username\u001b[33m:\u001b[39m string)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\u001b[0m\n\n      at UsersService.findOne (src/users/users.service.ts:40:37)\n      at UsersService.updatePassword (src/users/users.service.ts:81:33)\n      at Object.<anonymous> (src/users/users.service.spec.ts:100:34)\n    at Object.toThrow (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\expect\\build\\index.js:2155:20)\n    at Object.<anonymous> (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\src\\users\\users.service.spec.ts:100:81)\n    at Promise.finally.completed (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1557:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1497:10)\n    at _callCircusTest (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1007:40)\n    at _runTest (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:947:3)\n    at C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:849:7\n    at _runTestsForDescribeBlock (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:862:11)\n    at _runTestsForDescribeBlock (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at _runTestsForDescribeBlock (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at run (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:761:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1918:21)\n    at jestAdapter (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\runner.js:101:19)\n    at runTestInternal (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-runner\\build\\index.js:275:16)\n    at runTest (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-runner\\build\\index.js:343:7)"],"fullName":"UsersService updatePassword should throw if user not found","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"startAt":1772046669132,"status":"failed","title":"should throw if user not found"},{"ancestorTitles":["UsersService","updatePassword"],"duration":2,"failing":false,"failureDetails":[{}],"failureMessages":["TypeError: Cannot redefine property: compare\n    at Function.defineProperty (<anonymous>)\n    at ModuleMocker.spyOn (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-mock\\build\\index.js:616:16)\n    at Object.<anonymous> (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\src\\users\\users.service.spec.ts:105:18)\n    at Promise.finally.completed (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1557:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1497:10)\n    at _callCircusTest (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1007:40)\n    at _runTest (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:947:3)\n    at C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:849:7\n    at _runTestsForDescribeBlock (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:862:11)\n    at _runTestsForDescribeBlock (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at _runTestsForDescribeBlock (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at run (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:761:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1918:21)\n    at jestAdapter (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\runner.js:101:19)\n    at runTestInternal (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-runner\\build\\index.js:275:16)\n    at runTest (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-runner\\build\\index.js:343:7)"],"fullName":"UsersService updatePassword should throw if old password does not match","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"startAt":1772046669144,"status":"failed","title":"should throw if old password does not match"},{"ancestorTitles":["UsersService","updatePassword"],"duration":1,"failing":false,"failureDetails":[{}],"failureMessages":["TypeError: Cannot redefine property: compare\n    at Function.defineProperty (<anonymous>)\n    at ModuleMocker.spyOn (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-mock\\build\\index.js:616:16)\n    at Object.<anonymous> (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\src\\users\\users.service.spec.ts:112:18)\n    at Promise.finally.completed (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1557:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1497:10)\n    at _callCircusTest (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1007:40)\n    at _runTest (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:947:3)\n    at C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:849:7\n    at _runTestsForDescribeBlock (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:862:11)\n    at _runTestsForDescribeBlock (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at _runTestsForDescribeBlock (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:857:11)\n    at run (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:761:3)\n    at runAndTransformResultsToJestFormat (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\jestAdapterInit.js:1918:21)\n    at jestAdapter (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-circus\\build\\runner.js:101:19)\n    at runTestInternal (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-runner\\build\\index.js:275:16)\n    at runTest (C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\node_modules\\jest-runner\\build\\index.js:343:7)"],"fullName":"UsersService updatePassword should update password and hash the new one","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"startAt":1772046669150,"status":"failed","title":"should update password and hash the new one"}],"endTime":1772046669156,"message":"  ÔùÅ UsersService ÔÇ║ uploadAvatar ÔÇ║ should upload file and update user avatar url\n\n    TypeError: this.usersRepository.findOneBy is not a function\n\n    \u001b[0m \u001b[90m 38 |\u001b[39m\n     \u001b[90m 39 |\u001b[39m     \u001b[36masync\u001b[39m findOne(id\u001b[33m:\u001b[39m number)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m         \u001b[36mreturn\u001b[39m \u001b[36mthis\u001b[39m\u001b[33m.\u001b[39musersRepository\u001b[33m.\u001b[39mfindOneBy({ id })\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 41 |\u001b[39m     }\n     \u001b[90m 42 |\u001b[39m\n     \u001b[90m 43 |\u001b[39m     \u001b[36masync\u001b[39m findByUsername(username\u001b[33m:\u001b[39m string)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\u001b[0m\n\n      at UsersService.findOne (users/users.service.ts:40:37)\n      at UsersService.uploadAvatar (users/users.service.ts:26:40)\n      at Object.<anonymous> (users/users.service.spec.ts:65:28)\n\n  ÔùÅ UsersService ÔÇ║ updatePassword ÔÇ║ should throw if user not found\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected substring: \"Utilisateur introuvable.\"\n    Received message:   \"this.usersRepository.findOneBy is not a function\"\n\n        \u001b[0m \u001b[90m 38 |\u001b[39m\n         \u001b[90m 39 |\u001b[39m     \u001b[36masync\u001b[39m findOne(id\u001b[33m:\u001b[39m number)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\n        \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 40 |\u001b[39m         \u001b[36mreturn\u001b[39m \u001b[36mthis\u001b[39m\u001b[33m.\u001b[39musersRepository\u001b[33m.\u001b[39mfindOneBy({ id })\u001b[33m;\u001b[39m\n         \u001b[90m    |\u001b[39m                                     \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n         \u001b[90m 41 |\u001b[39m     }\n         \u001b[90m 42 |\u001b[39m\n         \u001b[90m 43 |\u001b[39m     \u001b[36masync\u001b[39m findByUsername(username\u001b[33m:\u001b[39m string)\u001b[33m:\u001b[39m \u001b[33mPromise\u001b[39m\u001b[33m<\u001b[39m\u001b[33mUser\u001b[39m \u001b[33m|\u001b[39m \u001b[36mnull\u001b[39m\u001b[33m>\u001b[39m {\u001b[0m\n\n      at UsersService.findOne (users/users.service.ts:40:37)\n      at UsersService.updatePassword (users/users.service.ts:81:33)\n      at Object.<anonymous> (users/users.service.spec.ts:100:34)\n      at Object.toThrow (../node_modules/expect/build/index.js:2155:20)\n      at Object.<anonymous> (users/users.service.spec.ts:100:81)\n\n  ÔùÅ UsersService ÔÇ║ updatePassword ÔÇ║ should throw if old password does not match\n\n    TypeError: Cannot redefine property: compare\n        at Function.defineProperty (<anonymous>)\n\n    \u001b[0m \u001b[90m 103 |\u001b[39m         it(\u001b[32m'should throw if old password does not match'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 104 |\u001b[39m             mockUserRepository\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValue({ id\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passwordHash\u001b[33m:\u001b[39m \u001b[32m'hashedOld'\u001b[39m })\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 105 |\u001b[39m             jest\u001b[33m.\u001b[39mspyOn(bcrypt\u001b[33m,\u001b[39m \u001b[32m'compare'\u001b[39m)\u001b[33m.\u001b[39mmockImplementation(\u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m \u001b[36mfalse\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                  \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 106 |\u001b[39m\n     \u001b[90m 107 |\u001b[39m             \u001b[36mawait\u001b[39m expect(service\u001b[33m.\u001b[39mupdatePassword(\u001b[35m1\u001b[39m\u001b[33m,\u001b[39m updatePasswordDto))\u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m'L\\'ancien mot de passe est incorrect.'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 108 |\u001b[39m         })\u001b[33m;\u001b[39m\u001b[0m\n\n      at ModuleMocker.spyOn (../node_modules/jest-mock/build/index.js:616:16)\n      at Object.<anonymous> (users/users.service.spec.ts:105:18)\n\n  ÔùÅ UsersService ÔÇ║ updatePassword ÔÇ║ should update password and hash the new one\n\n    TypeError: Cannot redefine property: compare\n        at Function.defineProperty (<anonymous>)\n\n    \u001b[0m \u001b[90m 110 |\u001b[39m         it(\u001b[32m'should update password and hash the new one'\u001b[39m\u001b[33m,\u001b[39m \u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m {\n     \u001b[90m 111 |\u001b[39m             mockUserRepository\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValue({ id\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m\u001b[33m,\u001b[39m passwordHash\u001b[33m:\u001b[39m \u001b[32m'hashedOld'\u001b[39m })\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 112 |\u001b[39m             jest\u001b[33m.\u001b[39mspyOn(bcrypt\u001b[33m,\u001b[39m \u001b[32m'compare'\u001b[39m)\u001b[33m.\u001b[39mmockImplementation(\u001b[36masync\u001b[39m () \u001b[33m=>\u001b[39m \u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                  \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 113 |\u001b[39m             mockAuthService\u001b[33m.\u001b[39mhashPassword\u001b[33m.\u001b[39mmockResolvedValue(\u001b[32m'hashedNew'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 114 |\u001b[39m             mockUserRepository\u001b[33m.\u001b[39mupdate\u001b[33m.\u001b[39mmockResolvedValue({ affected\u001b[33m:\u001b[39m \u001b[35m1\u001b[39m })\u001b[33m;\u001b[39m\n     \u001b[90m 115 |\u001b[39m\u001b[0m\n\n      at ModuleMocker.spyOn (../node_modules/jest-mock/build/index.js:616:16)\n      at Object.<anonymous> (users/users.service.spec.ts:112:18)\n","name":"C:\\Users\\yonid\\.gemini\\antigravity\\scratch\\japan-trip-planner\\backend\\src\\users\\users.service.spec.ts","startTime":1772046667861,"status":"failed","summary":""}],"wasInterrupted":false}
